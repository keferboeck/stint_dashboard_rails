<!-- app/views/admin/campaign_wizards/configure.html.erb -->

<% token = @form&.dig(:token) || params[:token] %>

<div class="max-w-3xl mx-auto bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-xl font-semibold mb-4">Configure campaign</h2>

  <% if (@errors || []).any? %>
    <div class="mb-4 p-3 rounded bg-red-500/15 text-red-200">
      <ul class="list-disc pl-5">
        <% @errors.each do |e| %><li><%= e %></li><% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with url: configure_admin_campaign_wizard_path, method: :post, class: "space-y-4" do |f| %>
    <%= hidden_field_tag "campaign[token]", token %>

    <div>
      <label class="block mb-1 text-sm text-white/80">Subject</label>
      <%= text_field_tag "campaign[subject]",
                         @form&.dig(:subject),
                         class: "w-full bg-white/10 border border-white/10 rounded px-3 py-2 text-white placeholder-white/40" %>
    </div>

    <div>
      <label class="block mb-1 text-sm text-white/80">Preview text (optional)</label>
      <%= text_field_tag "campaign[preview_text]",
                         @form&.dig(:preview_text),
                         class: "w-full bg-white/10 border border-white/10 rounded px-3 py-2 text-white placeholder-white/40" %>
    </div>

    <div>
      <label class="block mb-1 text-sm text-white/80">Template</label>
      <%= select_tag "campaign[template_name]",
                     options_for_select(@templates, @form&.dig(:template_name)),
                     include_blank: "Select a template",
                     class: "w-full bg-white/10 border border-white/10 rounded px-3 py-2 text-white" %>
    </div>

    <div class="flex items-center gap-3">
      <label class="inline-flex items-center gap-2">
        <%= check_box_tag "campaign[send_now]", "1", @form&.dig(:send_now) %>
        <span>Send now</span>
      </label>
    </div>

    <div>
      <label class="block mb-1 text-sm text-white/80">Schedule (UK time)</label>
      <%= text_field_tag "campaign[scheduled_at_local]",
                         @form&.dig(:scheduled_at_local),
                         placeholder: "YYYY-MM-DDTHH:MM",
                         class: "w-full bg-white/10 border border-white/10 rounded px-3 py-2 text-white placeholder-white/40" %>
      <p class="text-xs text-white/50 mt-1">Leave blank if “Send now” is ticked.</p>
    </div>

    <div class="pt-3 flex items-center gap-3">
      <%= link_to "Cancel", cancel_admin_campaign_wizard_path(token: token), data: { turbo_method: :delete }, class: "px-3 py-2 rounded bg-white/10 hover:bg-white/15" %>
      <%= link_to "Back", preview_admin_campaign_wizard_path(token: token), class: "px-3 py-2 rounded bg-white/10 hover:bg-white/15" %>
      <%= link_to "Finalize", finalize_admin_campaign_wizard_path(token: token), class: "ml-auto px-4 py-2 rounded bg-brand-green/20 hover:bg-brand-green/30" %>
    </div>
  <% end %>
</div>